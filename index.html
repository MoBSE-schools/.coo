<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School Staff Dashboard (GitHub Pages)</title>
  <meta name="description" content="Teachers, Cooks, Caretakers, Secretaries — Admin CRUD + local persistence (works on GitHub Pages)." />
  <style>
    :root{
      --bg:#f3f7fb;--card:#ffffff;--muted:#6b7280;--primary:#0b63ff;--radius:12px;--shadow:0 8px 30px rgba(2,6,23,0.06)
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#eef6ff);color:#06202a}
    .wrap{max-width:1200px;margin:28px auto;padding:18px}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px}
    h1{margin:0;font-size:20px}
    .small{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--primary);color:#fff;padding:8px 12px;border:none;border-radius:10px;cursor:pointer;box-shadow:var(--shadow)}
    .btn.ghost{background:transparent;color:var(--primary);border:1px solid rgba(11,99,255,0.12);box-shadow:none}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:16px}
    .card{background:var(--card);padding:12px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .panel{height:72vh;overflow:auto}
    .section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:12px}
    .stat{background:#fff;padding:12px;border-radius:8px;text-align:center}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:left}
    thead th{background:linear-gradient(90deg,#fbfbff,#f7fafc);position:sticky;top:0}
    tbody tr:nth-child(even){background:#fbfdff}
    .muted{color:var(--muted)}
    .input,select{padding:8px;border-radius:8px;border:1px solid #e6eef8}
    .modal{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal-card{width:640px;max-width:95%;background:#fff;padding:16px;border-radius:12px;box-shadow:var(--shadow)}
    @media (max-width:980px){.grid{grid-template-columns:1fr}.stat-grid{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>School Staff Dashboard</h1>
        <div class="small">Teachers · Cooks · Caretakers · Secretaries — male/female + totals</div>
      </div>

      <div class="controls">
        <button class="btn" id="adminOpenBtn">Admin</button>
        <button class="btn ghost" id="resetBtn">Reset Sample</button>
        <button class="btn ghost" id="exportBtn">Export JSON</button>
        <label class="btn ghost" for="importFile" style="margin:0;cursor:pointer">Import JSON</label>
        <input id="importFile" type="file" accept=".json" style="display:none" />
      </div>
    </header>

    <div class="grid">
      <main>
        <div class="card panel">
          <div class="section-title">
            <strong>Overview</strong>
            <div class="small">Live totals (updates automatically)</div>
          </div>

          <div id="overview" class="stat-grid"></div>

          <div style="margin:10px 0">
            <label class="small">Filter by region</label>
            <select id="regionFilter" class="input" style="width:100%;margin-top:6px"></select>
          </div>

          <div id="content"></div>
        </div>
      </main>

      <aside>
        <div class="card">
          <div class="section-title"><strong>Admin Panel</strong><span class="small muted"> (client-only)</span></div>
          <div class="small muted">Logged in as: <strong id="adminUser">-</strong></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn ghost" id="addRegionBtn">+ Region</button>
            <button class="btn ghost" id="addDistrictBtn">+ District</button>
            <button class="btn ghost" id="addSchoolBtn">+ School</button>
          </div>
          <div style="height:10px"></div>
          <div class="small muted">Admin credentials: <strong>admin</strong> / <strong>1234</strong></div>
          <div style="height:10px"></div>
          <div style="display:flex;gap:8px">
            <button class="btn ghost" id="loginBtn">Login</button>
            <button class="btn ghost" id="logoutBtn" style="display:none">Logout</button>
          </div>
          <hr style="margin-top:12px" />
          <div class="small">Tips:
            <ul>
              <li>Login to create/edit/delete regions, districts, schools and staff.</li>
              <li>Use Export/Import to backup data</li>
            </ul>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="card small muted">
          <strong>Deploy notes</strong>
          <ol>
            <li>Place <code>index.html</code> in repo root (or <code>docs/</code>), enable GitHub Pages.</li>
            <li>Add empty file <code>.nojekyll</code> to repo root to avoid Jekyll processing.</li>
          </ol>
        </div>
      </aside>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="modal"><div class="modal-card">
    <h3>Admin Login</h3>
    <div style="margin-top:8px"><input id="loginUser" class="input" placeholder="username" value="admin" style="width:100%"/></div>
    <div style="margin-top:8px"><input id="loginPass" type="password" class="input" placeholder="password" value="1234" style="width:100%"/></div>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
      <button id="cancelLogin" class="btn ghost">Cancel</button>
      <button id="doLogin" class="btn">Login</button>
    </div>
  </div></div>

  <!-- Edit Staff Modal -->
  <div id="staffModal" class="modal"><div class="modal-card">
    <h3>Edit Staff for <span id="staffModalSchool"></span></h3>
    <div class="small muted" id="staffModalPath" style="margin-bottom:8px"></div>
    <form id="staffForm">
      <div id="staffInputs"></div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button type="button" id="cancelStaff" class="btn ghost">Cancel</button>
        <button type="submit" class="btn">Save</button>
      </div>
    </form>
  </div></div>

  <!-- Add Entity Modal (Region/District/School) -->
  <div id="addModal" class="modal"><div class="modal-card">
    <h3 id="addModalTitle">Add</h3>
    <div id="addModalBody"></div>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
      <button id="cancelAdd" class="btn ghost">Cancel</button>
      <button id="saveAdd" class="btn">Add</button>
    </div>
  </div></div>

<script>
/* --------------- CONFIG & STORAGE --------------- */
const STORAGE_KEY = 'school_dashboard_github_v1';
const CATEGORIES = ['Teachers','Cooks','Caretakers','Secretaries'];

// Load or create sample
function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min }
function sampleData(){
  const regions = ['Banjul','Kanifing','West Coast','Lower River','Central River','Upper River','North Bank'];
  const data = { regions: [] };
  regions.forEach((name,ri)=>{
    const r = { id: 'r'+ri, name, districts: [] };
    const nd = rand(2,4);
    for(let di=0; di<nd; di++){
      const d = { id: r.id+'d'+di, name: `${name} District ${di+1}`, schools: [] };
      const ns = rand(3,6);
      for(let si=0; si<ns; si++){
        const s = { id: d.id+'s'+si, name: `School ${si+1}`, type: ['Primary','Junior','Senior'][rand(0,2)], staff: {} };
        CATEGORIES.forEach(cat=>{
          let m=0,f=0;
          if(cat==='Teachers'){ m = rand(0,12); f = rand(2,12); }
          else if(cat==='Cooks'){ m = rand(0,2); f = rand(0,4); }
          else if(cat==='Caretakers'){ m = rand(0,2); f = rand(0,1); }
          else if(cat==='Secretaries'){ m = rand(0,1); f = rand(0,2); }
          s.staff[cat] = { male: m, female: f };
        });
        d.schools.push(s);
      }
      r.districts.push(d);
    }
    data.regions.push(r);
  });
  return data;
}

function loadState(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw) {
    try { return JSON.parse(raw); } catch(e){ console.warn('bad json'); }
  }
  const samp = sampleData();
  localStorage.setItem(STORAGE_KEY, JSON.stringify(samp));
  return samp;
}
let STATE = loadState();
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(STATE)); renderAll(); }

/* --------------- AGGREGATION HELPERS --------------- */
function schoolTotals(s){
  const out = {}; let total=0;
  CATEGORIES.forEach(cat=> {
    const m = (s.staff[cat]?.male) || 0;
    const f = (s.staff[cat]?.female) || 0;
    out[cat] = {male:m,female:f,total:m+f};
    total += m+f;
  });
  return {byCategory: out, total};
}
function districtTotals(d){
  const out = {}; let tot=0; CATEGORIES.forEach(c=>out[c]=0);
  d.schools.forEach(s=>{ CATEGORIES.forEach(c=>{ out[c] += (s.staff[c]?.male||0) + (s.staff[c]?.female||0); tot += (s.staff[c]?.male||0) + (s.staff[c]?.female||0); })});
  return {byCategory:out,total:tot};
}
function regionTotals(r){
  const out = {}; let tot=0; CATEGORIES.forEach(c=>out[c]=0);
  r.districts.forEach(d=>{ d.schools.forEach(s=>{ CATEGORIES.forEach(c=>{ out[c] += (s.staff[c]?.male||0) + (s.staff[c]?.female||0); tot += (s.staff[c]?.male||0) + (s.staff[c]?.female||0); })})});
  return {byCategory:out,total:tot};
}
function nationalTotals(){
  const out = {}; let tot=0; CATEGORIES.forEach(c=>out[c]=0);
  STATE.regions.forEach(r=>{ r.districts.forEach(d=>{ d.schools.forEach(s=>{ CATEGORIES.forEach(c=>{ out[c] += (s.staff[c]?.male||0) + (s.staff[c]?.female||0); tot += (s.staff[c]?.male||0) + (s.staff[c]?.female||0); })})})});
  return {byCategory:out,total:tot};
}

/* --------------- RENDER --------------- */
const regionFilter = document.getElementById('regionFilter');
const overviewEl = document.getElementById('overview');
const contentEl = document.getElementById('content');
const adminUserEl = document.getElementById('adminUser');

function renderAll(){
  renderRegionFilter();
  renderOverview();
  renderRegions();
  updateAdminState();
}
function renderRegionFilter(){
  const opts = ['<option value="all">All Regions</option>'];
  STATE.regions.forEach(r=> opts.push(`<option value="${r.id}">${escapeHtml(r.name)}</option>`));
  regionFilter.innerHTML = opts.join('');
}
function renderOverview(){
  const nat = nationalTotals();
  const parts = CATEGORIES.map(c=> `<div class="stat"><h3>${nat.byCategory[c]||0}</h3><p>${c}</p></div>`).join('');
  overviewEl.innerHTML = parts + `<div class="stat" style="grid-column:span 3"><h3>${nat.total}</h3><p>National total</p></div>`;
}
function renderRegions(){
  const selected = regionFilter.value || 'all';
  let html = '';
  const regs = selected === 'all' ? STATE.regions : STATE.regions.filter(r=>r.id===selected);
  regs.forEach(r=>{
    const rt = regionTotals(r);
    html += `<div class="card" style="margin-bottom:12px"><div class="section-title"><strong>${escapeHtml(r.name)}</strong><div class="small muted">Region total: ${rt.total}</div></div>`;
    r.districts.forEach(d=>{
      const dt = districtTotals(d);
      html += `<div class="card" style="margin-bottom:10px;padding:10px"><div class="section-title"><strong>${escapeHtml(d.name)}</strong><div class="small muted">District total: ${dt.total} | Schools: ${d.schools.length}</div></div>`;
      d.schools.forEach(s=>{
        const st = schoolTotals(s);
        html += `<div class="card" style="margin-bottom:8px;padding:10px">
          <div class="section-title">
            <strong>${escapeHtml(s.name)} — ${escapeHtml(s.type)}</strong>
            <div>
              <button class="btn ghost editNameBtn" data-region="${r.id}" data-district="${d.id}" data-school="${s.id}">Edit</button>
              <button class="btn ghost editStaffBtn" data-region="${r.id}" data-district="${d.id}" data-school="${s.id}">Edit Staff</button>
              <button class="btn ghost delSchoolBtn" data-region="${r.id}" data-district="${d.id}" data-school="${s.id}">Delete</button>
            </div>
          </div>
          <div class="small muted">Total: ${st.total}</div>
          <table>
            <thead><tr><th>Category</th><th>Male</th><th>Female</th><th>Total</th></tr></thead>
            <tbody>${CATEGORIES.map(c=>`<tr><td>${c}</td><td>${s.staff[c]?.male||0}</td><td>${s.staff[c]?.female||0}</td><td>${(s.staff[c]?.male||0)+(s.staff[c]?.female||0)}</td></tr>`).join('')}
            </tbody>
          </table>
        </div>`;
      });
      html += `</div>`;
    });
    html += `</div>`;
  });
  contentEl.innerHTML = html;
}

/* safe HTML esc */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

/* --------------- EVENTS & ADMIN --------------- */
regionFilter.addEventListener('change', renderAll);
document.getElementById('resetBtn').addEventListener('click', ()=>{ if(confirm('Reset sample data?')){ STATE = sampleData(); saveState(); alert('Reset done'); } });
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(STATE, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'school_data.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
document.getElementById('importFile').addEventListener('change', (ev)=>{
  const f = ev.target.files[0]; if(!f) return;
  const r = new FileReader();
  r.onload = ()=> {
    try{
      const parsed = JSON.parse(r.result);
      if(!parsed.regions) throw new Error('Invalid structure');
      if(confirm('Import will replace current data. Continue?')){ STATE = parsed; saveState(); alert('Import complete'); }
    }catch(err){ alert('Import failed: invalid JSON format'); }
  };
  r.readAsText(f);
});

/* login/logout */
function updateAdminState(){
  const u = sessionStorage.getItem('adminUser');
  document.getElementById('adminUser').textContent = u || '-';
  document.getElementById('logoutBtn').style.display = u ? 'inline-block' : 'none';
  document.getElementById('loginBtn').style.display = u ? 'none' : 'inline-block';
}
document.getElementById('adminOpenBtn').addEventListener('click', ()=> {
  if(sessionStorage.getItem('adminUser')){ alert('Admin already logged in'); updateAdminState(); } else openLoginModal();
});
document.getElementById('loginBtn').addEventListener('click', ()=> openLoginModal());
document.getElementById('logoutBtn').addEventListener('click', ()=> { sessionStorage.removeItem('adminUser'); updateAdminState(); alert('Logged out'); });

function openLoginModal(){
  const m = document.getElementById('loginModal'); m.style.display='flex';
  document.getElementById('cancelLogin').onclick = ()=> m.style.display='none';
  document.getElementById('doLogin').onclick = ()=>{
    const u = document.getElementById('loginUser').value;
    const p = document.getElementById('loginPass').value;
    if(u==='admin' && p==='1234'){ sessionStorage.setItem('adminUser','admin'); m.style.display='none'; updateAdminState(); alert('Login successful'); }
    else alert('Invalid credentials');
  };
}

/* Add region/district/school modals */
document.getElementById('addRegionBtn').addEventListener('click', ()=> requireAdmin(openAddModal.bind(null,'region')));
document.getElementById('addDistrictBtn').addEventListener('click', ()=> requireAdmin(openAddModal.bind(null,'district')));
document.getElementById('addSchoolBtn').addEventListener('click', ()=> requireAdmin(openAddModal.bind(null,'school')));

function requireAdmin(cb){
  if(!sessionStorage.getItem('adminUser')) return alert('Please login as admin first (admin / 1234)');
  cb();
}

function openAddModal(kind){
  const modal = document.getElementById('addModal');
  const title = document.getElementById('addModalTitle');
  const body = document.getElementById('addModalBody');
  title.textContent = `Add ${kind.charAt(0).toUpperCase()+kind.slice(1)}`;
  body.innerHTML = '';
  if(kind==='region'){
    body.innerHTML = `<div style="display:flex;flex-direction:column;gap:8px"><input id="newRegionName" class="input" placeholder="Region name" /></div>`;
  } else if(kind==='district'){
    body.innerHTML = `<div style="display:flex;flex-direction:column;gap:8px">
      <label class="small">Choose region</label>
      <select id="chooseRegion" class="input">${STATE.regions.map(r=>`<option value="${r.id}">${escapeHtml(r.name)}</option>`).join('')}</select>
      <input id="newDistrictName" class="input" placeholder="District name" />
    </div>`;
  } else if(kind==='school'){
    body.innerHTML = `<div style="display:flex;flex-direction:column;gap:8px">
      <label class="small">Choose region</label>
      <select id="chooseRegionForSchool" class="input">${STATE.regions.map(r=>`<option value="${r.id}">${escapeHtml(r.name)}</option>`).join('')}</select>
      <label class="small">Choose district</label>
      <select id="chooseDistrictForSchool" class="input"></select>
      <input id="newSchoolName" class="input" placeholder="School name" />
      <select id="newSchoolType" class="input"><option>Primary</option><option>Junior</option><option>Senior</option></select>
      <div class="small muted">Optional: initial staff counts</div>
      <div id="newSchoolStaff"></div>
    </div>`;
    // after DOM, populate district select & staff inputs
    setTimeout(()=>{
      const regSel = document.getElementById('chooseRegionForSchool');
      const distSel = document.getElementById('chooseDistrictForSchool');
      populateDistricts(regSel, distSel);
      regSel.onchange = ()=> populateDistricts(regSel, distSel);
      const container = document.getElementById('newSchoolStaff');
      CATEGORIES.forEach(cat=>{
        container.insertAdjacentHTML('beforeend', `<div style="display:flex;gap:8px;align-items:center;margin-top:6px">
          <div style="width:140px">${cat}</div>
          <input class="input" id="init_${cat}_m" placeholder="male" style="width:100px" />
          <input class="input" id="init_${cat}_f" placeholder="female" style="width:100px" />
        </div>`);
      });
    },10);
  }
  modal.style.display = 'flex';

  const cancel = document.getElementById('cancelAdd');
  const save = document.getElementById('saveAdd');

  cancel.onclick = ()=> { modal.style.display='none'; cleanup(); }
  save.onclick = ()=> {
    if(kind==='region'){
      const name = document.getElementById('newRegionName').value.trim(); if(!name) return alert('Region name required');
      STATE.regions.push({ id:'r'+Date.now(), name, districts: [] }); saveState(); modal.style.display='none'; cleanup();
    } else if(kind==='district'){
      const regionId = document.getElementById('chooseRegion').value;
      const name = document.getElementById('newDistrictName').value.trim(); if(!name) return alert('District name required');
      const region = STATE.regions.find(r=>r.id===regionId); if(!region) return alert('Region not found');
      region.districts.push({ id: region.id+'d'+Date.now(), name, schools: [] }); saveState(); modal.style.display='none'; cleanup();
    } else if(kind==='school'){
      const regionId = document.getElementById('chooseRegionForSchool').value;
      const districtId = document.getElementById('chooseDistrictForSchool').value;
      const name = document.getElementById('newSchoolName').value.trim(); const type = document.getElementById('newSchoolType').value;
      if(!regionId||!districtId||!name) return alert('Region, district and school name required');
      const region = STATE.regions.find(r=>r.id===regionId);
      const district = region.districts.find(d=>d.id===districtId);
      const staff = {};
      CATEGORIES.forEach(cat=> { staff[cat] = { male: parseInt(document.getElementById('init_'+cat+'_m')?.value)||0, female: parseInt(document.getElementById('init_'+cat+'_f')?.value)||0 }});
      district.schools.push({ id: district.id+'s'+Date.now(), name, type, staff }); saveState(); modal.style.display='none'; cleanup();
    }
  };

  function cleanup(){ cancel.onclick=null; save.onclick=null; }
}

function populateDistricts(regionSelect, districtSelect){
  const rid = regionSelect.value;
  const region = STATE.regions.find(r=>r.id===rid);
  if(!region){ districtSelect.innerHTML='<option value="">-- none --</option>'; return; }
  districtSelect.innerHTML = region.districts.map(d=>`<option value="${d.id}">${escapeHtml(d.name)}</option>`).join('');
}

/* delegate edit/delete buttons */
contentEl.addEventListener('click', (ev)=>{
  const btn = ev.target;
  if(btn.matches('.editStaffBtn')){
    const regionId = btn.dataset.region, districtId = btn.dataset.district, schoolId = btn.dataset.school;
    requireAdmin(()=> openStaffModal(regionId,districtId,schoolId));
  } else if(btn.matches('.delSchoolBtn')){
    requireAdmin(()=> {
      if(!confirm('Delete school?')) return;
      const regionId = btn.dataset.region, districtId = btn.dataset.district, schoolId = btn.dataset.school;
      const r = STATE.regions.find(x=>x.id===regionId); const d = r.districts.find(x=>x.id===districtId);
      d.schools = d.schools.filter(s=>s.id!==schoolId); saveState();
    });
  } else if(btn.matches('.editNameBtn')){
    requireAdmin(()=> {
      const regionId = btn.dataset.region, districtId = btn.dataset.district, schoolId = btn.dataset.school;
      openEditName(regionId,districtId,schoolId);
    });
  }
});

/* Edit Name modal quick */
function openEditName(regionId, districtId, schoolId){
  const title = schoolId ? 'Edit School name' : districtId ? 'Edit District name' : 'Edit Region name';
  document.getElementById('addModalTitle').textContent = title;
  const body = document.getElementById('addModalBody');
  let current = '';
  if(schoolId){ const r=STATE.regions.find(rr=>rr.id===regionId); const d=r.districts.find(dd=>dd.id===districtId); const s = d.schools.find(ss=>ss.id===schoolId); current=s.name; body.innerHTML=`<input id="editNameInput" class="input" value="${escapeHtml(current)}" />`; }
  else if(districtId){ const r=STATE.regions.find(rr=>rr.id===regionId); const d = r.districts.find(dd=>dd.id===districtId); current=d.name; body.innerHTML=`<input id="editNameInput" class="input" value="${escapeHtml(current)}" />`; }
  else { const r = STATE.regions.find(rr=>rr.id===regionId); current=r.name; body.innerHTML=`<input id="editNameInput" class="input" value="${escapeHtml(current)}" />`; }
  const modal = document.getElementById('addModal'); modal.style.display='flex';
  const cancel = document.getElementById('cancelAdd'); const save = document.getElementById('saveAdd');
  cancel.onclick = ()=> { modal.style.display='none'; cleanup(); }
  save.onclick = ()=> {
    const val = document.getElementById('editNameInput').value.trim();
    if(!val) return alert('Name required');
    if(schoolId){ const r=STATE.regions.find(rr=>rr.id===regionId); const d=r.districts.find(dd=>dd.id===districtId); const s=d.schools.find(ss=>ss.id===schoolId); s.name=val; }
    else if(districtId){ const r=STATE.regions.find(rr=>rr.id===regionId); const d = r.districts.find(dd=>dd.id===districtId); d.name=val; }
    else { const r = STATE.regions.find(rr=>rr.id===regionId); r.name=val; }
    saveState(); modal.style.display='none'; cleanup();
  };
  function cleanup(){ cancel.onclick=null; save.onclick=null; }
}

/* Staff Modal */
function openStaffModal(regionId, districtId, schoolId){
  const modal = document.getElementById('staffModal');
  const school = STATE.regions.find(r=>r.id===regionId).districts.find(d=>d.id===districtId).schools.find(s=>s.id===schoolId);
  document.getElementById('staffModalSchool').textContent = school.name;
  document.getElementById('staffModalPath').textContent = `${STATE.regions.find(r=>r.id===regionId).name} → ${STATE.regions.find(r=>r.id===regionId).districts.find(d=>d.id===districtId).name}`;
  const container = document.getElementById('staffInputs'); container.innerHTML = '';
  CATEGORIES.forEach(cat=>{
    const m = school.staff[cat]?.male || 0; const f = school.staff[cat]?.female || 0;
    container.insertAdjacentHTML('beforeend', `<div style="display:flex;gap:8px;align-items:center;margin-top:6px">
      <div style="width:140px">${cat}</div>
      <input class="input" id="staff_${cat}_m" type="number" min="0" value="${m}" style="width:120px" />
      <input class="input" id="staff_${cat}_f" type="number" min="0" value="${f}" style="width:120px" />
    </div>`);
  });
  modal.style.display='flex';
  document.getElementById('cancelStaff').onclick = ()=> { modal.style.display='none'; cleanup(); };
  document.getElementById('staffForm').onsubmit = (ev)=>{ ev.preventDefault();
    CATEGORIES.forEach(cat=> {
      const m = parseInt(document.getElementById('staff_'+cat+'_m').value) || 0;
      const f = parseInt(document.getElementById('staff_'+cat+'_f').value) || 0;
      school.staff[cat] = { male: m, female: f };
    });
    saveState(); modal.style.display='none'; cleanup(); alert('Staff updated');
  };
  function cleanup(){ document.getElementById('cancelStaff').onclick = null; document.getElementById('staffForm').onsubmit = null; }
}

/* small helper to require admin */
function requireAdmin(fn){
  if(!sessionStorage.getItem('adminUser')) return alert('Login as admin first (admin / 1234)');
  fn();
}

/* double click quick edit: attempt to find clicked title and open edit modal (optional) */
contentEl.addEventListener('dblclick', (ev)=>{
  if(!sessionStorage.getItem('adminUser')) return;
  let el = ev.target;
  while(el && el !== contentEl && !el.classList.contains('card')) el = el.parentElement;
  if(!el || el===contentEl) return;
  const strong = el.querySelector('.section-title strong');
  if(!strong) return;
  const text = strong.textContent.trim();
  // search through STATE for region/district/school by exact name
  for(const r of STATE.regions){
    if(r.name === text){ openEditName(r.id); return; }
    for(const d of r.districts){
      if(d.name === text){ openEditName(r.id, d.id); return; }
      for(const s of d.schools){
        if(s.name === text){ openEditName(r.id, d.id, s.id); return; }
      }
    }
  }
});

/* initial updateAdminState binding */
updateAdminState();

/* optional keyboard close for modals */
window.addEventListener('keydown', (e)=> { if(e.key==='Escape'){ document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); } });

/* clickable login modal open/close wiring is already set - also support sidebar login button */
document.getElementById('adminOpenBtn').addEventListener('click', ()=> openLoginModal());
function openLoginModal(){ document.getElementById('loginModal').style.display='flex' }

/* final init render */
renderAll();
</script>
</body>
</html>