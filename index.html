<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gambia Teacher Directory ‚Äî Full Demo (with Dashboard & Statistics)</title>
<meta name="description" content="Gambia Teacher Directory with nationwide dashboard, region summaries and statistics table ‚Äî Lamin Ceesay" />
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --muted:#9aa4b2;
    --gold:#d4af37;
    --silver:#c0c6cc;
    --diamond:#bfe9ff;
    --glass:rgba(255,255,255,0.04);
    --radius:12px;
    --maxw:1400px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:
      radial-gradient(1000px 360px at 8% 8%, rgba(212,175,55,0.06), transparent),
      radial-gradient(900px 280px at 92% 88%, rgba(191,233,255,0.03), transparent),
      var(--bg);
    color:#e6eef6;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:2rem 1rem;
  }
  .layout{max-width:var(--maxw);margin:0 auto;}
  header{display:flex;align-items:center;gap:1rem;justify-content:space-between;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:1rem;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:.6rem 1rem;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,0.5)}
  .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--gold),#ffd27f 40%,var(--diamond));display:grid;place-items:center;color:#08101a;font-weight:800;font-size:20px}
  h1{margin:0;font-size:1.25rem;line-height:1;color:var(--gold)}
  .lead{color:var(--muted);font-size:.95rem}
  .controls{display:flex;gap:.6rem;margin-top:.75rem;align-items:center;flex-wrap:wrap}
  .search{flex:1;display:flex;align-items:center;background:var(--glass);padding:.45rem;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .search input{background:transparent;border:0;color:inherit;padding:.45rem .6rem;outline:none;font-size:0.95rem}
  .btn{background:linear-gradient(90deg,var(--gold),#ffd27f);color:#08101a;padding:.5rem .9rem;border-radius:10px;border:0;font-weight:700;cursor:pointer}
  main{display:grid;grid-template-columns:320px 1fr;gap:1rem;margin-top:1rem}
  aside{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:1rem;border-radius:12px;border:1px solid rgba(255,255,255,0.03);min-height:68vh;overflow:auto}
  .region-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:.5rem}
  .region-item{padding:.6rem;border-radius:10px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;border:1px solid transparent}
  .region-item:hover{background:rgba(255,255,255,0.02)}
  .region-item.active{background:linear-gradient(90deg,rgba(212,175,55,0.06),rgba(191,233,255,0.02));border-color:rgba(212,175,55,0.08)}
  .content{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:1rem;border-radius:12px;border:1px solid rgba(255,255,255,0.03);min-height:68vh;overflow:auto}
  .district{background:rgba(255,255,255,0.01);padding:.8rem;border-radius:12px;margin-bottom:1rem;border:1px solid rgba(255,255,255,0.02)}
  .district h3{margin:0;color:var(--gold);font-size:1rem}
  .schools-grid{display:flex;flex-direction:column;gap:.6rem;margin-top:.6rem}
  .school{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:.6rem;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .school h4{margin:0 0 .45rem 0;font-size:0.95rem}
  .section-row{display:flex;gap:.6rem;flex-wrap:wrap}
  .section{flex:1;min-width:220px;background:rgba(255,255,255,0.01);padding:.5rem;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .teacher{display:flex;gap:.6rem;align-items:center;padding:.45rem;border-radius:10px;margin-bottom:.45rem;background:linear-gradient(90deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02)}
  .avatar-wrap{width:56px;height:56px;border-radius:8px;overflow:hidden;display:grid;place-items:center;background:linear-gradient(180deg,var(--silver),rgba(255,255,255,0.06))}
  .avatar{display:block;width:48px;height:48px;border-radius:8px;object-fit:cover}
  .initials{font-weight:700;color:#08101a}
  .tinfo{flex:1}
  .tinfo b{display:block}
  .tmeta{font-size:.85rem;color:var(--muted);margin-top:.25rem}
  footer{margin-top:1rem;color:var(--muted);font-size:.9rem;text-align:center}
  select{background:var(--glass);border:1px solid rgba(255,255,255,0.03);color:inherit;padding:.5rem;border-radius:10px}
  .dashboard{display:grid;grid-template-columns:1fr 320px;gap:1rem;margin-bottom:1rem}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:1rem;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .stats-grid{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
  .stat{flex:1;min-width:160px;padding:.8rem;border-radius:10px;background:linear-gradient(90deg, rgba(212,175,55,0.04), rgba(191,233,255,0.02));border:1px solid rgba(212,175,55,0.06)}
  .small{font-size:.9rem;color:var(--muted)}
  .region-summary{display:flex;gap:.6rem;flex-wrap:wrap;margin-bottom:.8rem}
  .rcard{flex:1;min-width:180px;padding:.6rem;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02)}
  table{width:100%;border-collapse:collapse}
  table th, table td{padding:.5rem;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03)}
  .muted{color:var(--muted)}
  .controls-row{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
  @media (max-width:980px){
    main{grid-template-columns:1fr}
    .dashboard{grid-template-columns:1fr}
    .stat{min-width:140px}
  }
</style>
</head>
<body>
  <div class="layout">
    <header>
      <div class="brand">
        <div class="logo">GM</div>
        <div>
          <h1>Gambia Teacher Directory</h1>
          <div class="lead">Regions ‚Üí Districts ‚Üí Schools ‚Üí Teachers ‚Äî (work by Lamin Ceesay)</div>
        </div>
      </div>
      <div style="display:flex;gap:.6rem;align-items:center">
        <button class="btn" id="viewStatsBtn">View Statistics</button>
        <button class="btn">Admin</button>
      </div>
    </header>

    <div class="controls">
      <div class="search"><svg width="18" height="18" viewBox="0 0 24 24" style="opacity:.85;margin-right:.4rem"><path d="M21 21l-4.35-4.35" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11.5" cy="11.5" r="5.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg><input id="searchInput" placeholder="Search teachers, schools, districts, regions" /></div>
      <select id="regionFilter"><option value="">All Regions</option></select>
      <select id="districtFilter"><option value="">All Districts</option></select>
      <select id="schoolFilter"><option value="">All Schools</option></select>
      <button class="btn" id="clearBtn">Clear</button>
    </div>

    <main>
      <aside>
        <h4 style="color:var(--gold);margin-bottom:.6rem">Views</h4>
        <ul class="region-list" id="regionList"></ul>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:1rem 0" />
        <div style="display:flex;gap:.5rem;flex-direction:column">
          <button class="btn" id="sidebarRegionsBtn">Regions</button>
          <button class="btn" id="sidebarStatsBtn">Statistics</button>
        </div>
      </aside>

      <section class="content" id="contentArea">
        <!-- Dashboard + Content injected here -->
      </section>
    </main>

    <footer>coding and editing in progress ‚Äî structure designed to be dynamic and extendable.</footer>
  </div>

<script>
/*
  Enhanced dataset UI:
  - Adds dashboard at the top with nationwide totals
  - Adds per-region totals and per-school totals display
  - Adds a statistics view with per-region table and overall totals
*/

// Gambian-like sample names (rotate)
const maleNames = [
  'Lamin Ceesay','Ebrima Jallow','Papa Bojang','Ousman Touray','Alieu Sanyang','Sainey Gomez',
  'Kebba Jatta','Musa Ceesay','Samba Faal','Pa Lamin Jammeh','Momodou Cham','Ebrima Colley'
];
const femaleNames = [
  'Fatou Ceesay','Aminata Bah','Isatou Jallow','Aja Kinteh','Binta Sanneh','Saffie Lowe',
  'Hawa Darboe','Mariama Sanyang','Salma Jallow','Kaddy Cham','Adama Sonko','Awa Jarju'
];

// Use the district lists we've referenced earlier in conversation (complete coverage)
const regions = [
  {
    name: 'Banjul',
    districts: ['Banjul Ward A','Banjul Ward B']
  },
  {
    name: 'Kanifing Municipality',
    districts: ['Serekunda East','Serekunda West','Brikama Road','Tallinding Kunjang','Latrikunda Sabiji']
  },
  {
    name: 'West Coast Region (Brikama)',
    districts: [
      'Kombo North','Kombo South','Kombo Central','Kombo East','Kombo Central II',
      'Foni Bintang-Karenai','Foni Brefet','Foni Jarrol','Foni Kansala'
    ]
  },
  {
    name: 'North Bank Region (Kerewan)',
    districts: ['Lower Niumi','Upper Niumi','Jokadu','Lower Baddibu','Central Baddibu','Upper Baddibu']
  },
  {
    name: 'Lower River Region (Mansa Konko)',
    districts: ['Kiang West','Kiang Central','Kiang East','Jarra West','Jarra Central','Jarra East']
  },
  {
    name: 'Central River Region (Janjanbureh)',
    districts: [
      'Janjanbureh','Niani','Nianija','Sami','Fulladu West',
      'Niamina East','Niamina West','Niamina Dankunku','Lower Saloum','Upper Saloum'
    ]
  },
  {
    name: 'Upper River Region (Basse)',
    districts: ['Fulladu East','Kantora','Sandu','Tumana','Wuli West','Wuli East','Jimara']
  }
];

// id generator for dummy TIN and ID numbers
let idCounter = 200000;
function genID(prefix){
  idCounter++;
  return `${prefix}-${String(idCounter).padStart(6,'0')}`;
}

// build the full dataset
const fullData = regions.map(region => {
  return {
    region: region.name,
    districts: region.districts.map(districtName => {
      // create school lists as required:
      const primary = Array.from({length:5},(_,i)=>({ level:'Primary', name:`${districtName} Primary School #${i+1}` }));
      const junior  = Array.from({length:4},(_,i)=>({ level:'Junior',  name:`${districtName} Junior School #${i+1}` }));
      const senior  = Array.from({length:5},(_,i)=>({ level:'Senior',  name:`${districtName} Senior School #${i+1}` }));
      const schools = [...primary, ...junior, ...senior];

      // assign teachers to each school
      const schoolsWithTeachers = schools.map((school, sIndex) => {
        const teachers = Array.from({length:6}, (_, tIndex) => {
          const gender = tIndex < 3 ? 'Male' : 'Female';
          const name = gender === 'Male'
            ? maleNames[(sIndex + tIndex) % maleNames.length]
            : femaleNames[(sIndex + tIndex) % femaleNames.length];

          const initials = name.split(' ').map(n => n[0]).slice(0,2).join('');
          // placeholder image service (can be loaded from internet) - using text=initials
          const photo = `https://via.placeholder.com/120/ffffff/08101a?text=${encodeURIComponent(initials)}`;

          return {
            name,
            initials,
            gender,
            tin: genID('TIN'),
            idNo: genID('GMBID'),
            shift: (tIndex % 2 === 0) ? 'Morning' : 'Afternoon',
            experience: 2 + ((sIndex + tIndex) % 10),
            photo
          };
        });

        return {
          ...school,
          teachers
        };
      });

      return {
        district: districtName,
        schools: schoolsWithTeachers
      };
    })
  };
});

// UI references
const regionListEl = document.getElementById('regionList');
const contentArea = document.getElementById('contentArea');
const searchInput = document.getElementById('searchInput');
const regionFilter = document.getElementById('regionFilter');
const districtFilter = document.getElementById('districtFilter');
const schoolFilter = document.getElementById('schoolFilter');
const clearBtn = document.getElementById('clearBtn');
const viewStatsBtn = document.getElementById('viewStatsBtn');
const sidebarRegionsBtn = document.getElementById('sidebarRegionsBtn');
const sidebarStatsBtn = document.getElementById('sidebarStatsBtn');

let currentView = 'regions'; // 'regions' or 'stats'
let currentRegionIndex = 0;

// populate sidebar and region dropdown
fullData.forEach((r, regionIndex) => {
  // sidebar item
  const li = document.createElement('li');
  li.className = 'region-item';
  li.innerHTML = `<span>${r.region}</span><small style="color:var(--muted)">View</small>`;
  li.addEventListener('click', () => {
    selectRegion(regionIndex);
    regionFilter.value = r.region;
    populateDistricts(r);
    currentView = 'regions';
    render();
  });
  regionListEl.appendChild(li);

  // dropdown option
  const opt = document.createElement('option');
  opt.value = r.region;
  opt.textContent = r.region;
  regionFilter.appendChild(opt);
});

// helper: compute totals across dataset (nationwide and by region)
function computeTotals(){
  const totals = {
    nationwide: { total:0, male:0, female:0, byLevel: { Primary:0, Junior:0, Senior:0 } },
    regions: [] // { region, total, male, female, byLevel: {Primary, Junior, Senior} }
  };

  fullData.forEach(r => {
    const rTotal = { region: r.region, total:0, male:0, female:0, byLevel: { Primary:0, Junior:0, Senior:0 } };
    r.districts.forEach(d => {
      d.schools.forEach(s => {
        s.teachers.forEach(t => {
          rTotal.total += 1;
          totals.nationwide.total += 1;
          if(t.gender === 'Male'){ rTotal.male += 1; totals.nationwide.male += 1; }
          else { rTotal.female += 1; totals.nationwide.female += 1; }
          // by level
          if(!rTotal.byLevel[s.level]) rTotal.byLevel[s.level] = 0;
          rTotal.byLevel[s.level] += 1;
          if(!totals.nationwide.byLevel[s.level]) totals.nationwide.byLevel[s.level] = 0;
          totals.nationwide.byLevel[s.level] += 1;
        });
      });
    });
    totals.regions.push(rTotal);
  });

  return totals;
}

// render Dashboard (nationwide) at top
function renderDashboard(){
  const totals = computeTotals();
  // dashboard HTML
  const dash = document.createElement('div');
  dash.className = 'dashboard';

  const mainCard = document.createElement('div');
  mainCard.className = 'card';
  const nationwide = totals.nationwide;
  mainCard.innerHTML = `
    <h3 style="margin-top:0;color:var(--gold)">üßæ Nationwide Summary</h3>
    <div class="stats-grid" style="margin-top:.6rem">
      <div class="stat">
        <div style="font-size:1.3rem;font-weight:800">${nationwide.total}</div>
        <div class="small">Total Teachers (Nationwide)</div>
      </div>
      <div class="stat">
        <div style="font-size:1.1rem;font-weight:800">${nationwide.male}</div>
        <div class="small">Male Teachers</div>
      </div>
      <div class="stat">
        <div style="font-size:1.1rem;font-weight:800">${nationwide.female}</div>
        <div class="small">Female Teachers</div>
      </div>
      <div class="stat">
        <div style="font-size:1.1rem;font-weight:800">${nationwide.byLevel.Primary || 0}</div>
        <div class="small">Primary Teachers</div>
      </div>
      <div class="stat">
        <div style="font-size:1.1rem;font-weight:800">${nationwide.byLevel.Junior || 0}</div>
        <div class="small">Junior Teachers</div>
      </div>
      <div class="stat">
        <div style="font-size:1.1rem;font-weight:800">${nationwide.byLevel.Senior || 0}</div>
        <div class="small">Senior Teachers</div>
      </div>
    </div>

    <div style="margin-top:1rem">
      <h4 style="margin:.3rem 0 0 0;color:var(--gold)">By Region</h4>
      <div style="margin-top:.5rem;display:flex;gap:.5rem;flex-wrap:wrap">
        ${totals.regions.map(r => `<div class="rcard"><strong>${r.region}</strong><div class="small">${r.total} teachers</div><div class="small">P:${r.byLevel.Primary||0} ‚Ä¢ J:${r.byLevel.Junior||0} ‚Ä¢ S:${r.byLevel.Senior||0}</div></div>`).join('')}
      </div>
    </div>
  `;

  const rightCard = document.createElement('div');
  rightCard.className = 'card';
  rightCard.innerHTML = `
    <h4 style="margin-top:0;color:var(--gold)">Quick Actions</h4>
    <div class="small" style="margin-top:.5rem">Use filters or click a region from the left to view details.</div>
    <div style="margin-top:.8rem">
      <button class="btn" id="goToFirstRegion">Open First Region</button>
    </div>
    <div style="margin-top:1rem">
      <h5 style="margin:.2rem 0 0 0;color:var(--gold)">Totals Summary</h5>
      <div class="small" id="totalsSummaryText">${nationwide.total} total ‚Ä¢ ${nationwide.male}M ‚Ä¢ ${nationwide.female}F</div>
    </div>
  `;

  dash.appendChild(mainCard);
  dash.appendChild(rightCard);
  return dash;
}

// helper to return a per-region aggregate
function aggregateRegion(regionObj){
  const agg = { region: regionObj.region, total:0, male:0, female:0, byLevel:{ Primary:0, Junior:0, Senior:0 }, districtsCount: regionObj.districts.length };
  regionObj.districts.forEach(d => {
    d.schools.forEach(s => {
      s.teachers.forEach(t => {
        agg.total += 1;
        if(t.gender === 'Male') agg.male += 1; else agg.female += 1;
        agg.byLevel[s.level] = (agg.byLevel[s.level] || 0) + 1;
      });
    });
  });
  return agg;
}

// render region contents with a per-region summary card at the top
function renderRegion(regionObj){
  contentArea.innerHTML = '';
  // dashboard remains at top when in "regions" view
  const dash = renderDashboard();
  contentArea.appendChild(dash);

  const title = document.createElement('div');
  title.innerHTML = `<h2 style="color:var(--gold);margin:0 0 .5rem 0">${regionObj.region}</h2><div style="color:var(--muted);margin-bottom:.6rem">Districts & sample schools</div>`;
  contentArea.appendChild(title);

  // region summary card
  const agg = aggregateRegion(regionObj);
  const regionSummary = document.createElement('div');
  regionSummary.className = 'card';
  regionSummary.style.marginBottom = '1rem';
  regionSummary.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap">
      <div>
        <h3 style="margin:0;color:var(--gold)">${regionObj.region} ‚Äî Summary</h3>
        <div class="small" style="margin-top:.4rem">Total Teachers: <strong>${agg.total}</strong> ‚Ä¢ Male: <strong>${agg.male}</strong> ‚Ä¢ Female: <strong>${agg.female}</strong></div>
      </div>
      <div style="text-align:right">
        <div class="small">Primary: <strong>${agg.byLevel.Primary || 0}</strong></div>
        <div class="small">Junior: <strong>${agg.byLevel.Junior || 0}</strong></div>
        <div class="small">Senior: <strong>${agg.byLevel.Senior || 0}</strong></div>
      </div>
    </div>
  `;
  contentArea.appendChild(regionSummary);

  regionObj.districts.forEach(d => {
    const dEl = document.createElement('div');
    dEl.className = 'district';
    dEl.innerHTML = `<h3>üìç ${d.district}</h3>`;
    const grid = document.createElement('div');
    grid.className = 'schools-grid';

    d.schools.forEach(s => {
      const sEl = document.createElement('div');
      sEl.className = 'school';
      // compute per-school totals
      const total = s.teachers.length;
      const male = s.teachers.filter(t => t.gender === 'Male').length;
      const female = s.teachers.filter(t => t.gender === 'Female').length;
      sEl.innerHTML = `<h4>${s.name} <small style="color:var(--muted)">(${s.level})</small></h4>
        <div class="small" style="margin-bottom:.4rem">Total Teachers: <strong>${total}</strong> (${male}M / ${female}F)</div>`;

      const secRow = document.createElement('div');
      secRow.className = 'section-row';

      // Teachers card
      const section = document.createElement('div');
      section.className = 'section';
      section.innerHTML = `<small>Teachers</small>`;
      s.teachers.forEach(t => {
        const tEl = document.createElement('div');
        tEl.className = 'teacher';
        tEl.innerHTML = `
          <div class="avatar-wrap"><img class="avatar" src="${t.photo}" alt="${t.initials}" onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\\'initials\\'>${t.initials}</div>'" /></div>
          <div class="tinfo">
            <b>${t.name}</b>
            <div class="tmeta">${t.gender} ‚Ä¢ ${t.shift} shift ‚Ä¢ ${t.experience} yrs</div>
            <div class="tmeta">TIN: ${t.tin} ‚Ä¢ ID: ${t.idNo}</div>
          </div>
        `;
        section.appendChild(tEl);
      });

      secRow.appendChild(section);
      sEl.appendChild(secRow);
      grid.appendChild(sEl);
    });

    dEl.appendChild(grid);
    contentArea.appendChild(dEl);
  });
}

// Render filtered view (keeps dashboard at top), used for search and dropdown filters
function filterAndRender(){
  const q = (searchInput.value || '').trim().toLowerCase();
  const regionVal = regionFilter.value;
  const districtVal = districtFilter.value;
  const schoolVal = schoolFilter.value;

  // Build filtered subset
  const filtered = fullData
    .filter(r => !regionVal || r.region === regionVal)
    .map(r => {
      const districts = r.districts
        .filter(d => !districtVal || d.district === districtVal)
        .map(d => {
          const schools = d.schools
            .filter(s => !schoolVal || s.name === schoolVal)
            .map(s => {
              const teachers = s.teachers.filter(t =>
                !q ||
                t.name.toLowerCase().includes(q) ||
                s.name.toLowerCase().includes(q) ||
                d.district.toLowerCase().includes(q) ||
                r.region.toLowerCase().includes(q)
              );
              return {...s, teachers};
            })
            .filter(s => s.teachers.length > 0);
          return {...d, schools};
        })
        .filter(d => d.schools.length > 0);
      return {...r, districts};
    })
    .filter(r => r.districts.length > 0);

  // If nothing found show message with dashboard
  contentArea.innerHTML = '';
  const dash = renderDashboard();
  contentArea.appendChild(dash);

  if(filtered.length === 0){
    contentArea.innerHTML += `<div style="color:var(--muted);margin-top:1rem">No results found.</div>`;
    return;
  }

  filtered.forEach(r => {
    const regionTitle = document.createElement('h2');
    regionTitle.style.color = 'var(--gold)';
    regionTitle.style.marginTop = '0';
    regionTitle.textContent = r.region;
    contentArea.appendChild(regionTitle);

    // region agg
    const agg = aggregateRegion(r);
    const regionSummary = document.createElement('div');
    regionSummary.className = 'card';
    regionSummary.style.marginBottom = '1rem';
    regionSummary.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap">
      <div>
        <div style="font-weight:700;color:var(--gold)">${r.region}</div>
        <div class="small">${agg.total} teachers ‚Ä¢ ${agg.male}M ‚Ä¢ ${agg.female}F</div>
      </div>
      <div style="text-align:right">
        <div class="small">P: ${agg.byLevel.Primary||0}</div>
        <div class="small">J: ${agg.byLevel.Junior||0}</div>
        <div class="small">S: ${agg.byLevel.Senior||0}</div>
      </div>
    </div>`;
    contentArea.appendChild(regionSummary);

    r.districts.forEach(d => {
      const dEl = document.createElement('div');
      dEl.className = 'district';
      dEl.innerHTML = `<h3>üìç ${d.district}</h3>`;
      const grid = document.createElement('div');
      grid.className = 'schools-grid';

      d.schools.forEach(s => {
        const sEl = document.createElement('div');
        sEl.className = 'school';
        const total = s.teachers.length;
        const male = s.teachers.filter(t => t.gender === 'Male').length;
        const female = s.teachers.filter(t => t.gender === 'Female').length;
        sEl.innerHTML = `<h4>${s.name} <small style="color:var(--muted)">(${s.level})</small></h4>
          <div class="small" style="margin-bottom:.4rem">Total Teachers: <strong>${total}</strong> (${male}M / ${female}F)</div>`;
        const secRow = document.createElement('div');
        secRow.className = 'section-row';
        const section = document.createElement('div');
        section.className = 'section';
        section.innerHTML = `<small>Teachers</small>`;
        s.teachers.forEach(t => {
          const tEl = document.createElement('div');
          tEl.className = 'teacher';
          tEl.innerHTML = `
            <div class="avatar-wrap"><img class="avatar" src="${t.photo}" alt="${t.initials}" onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\\'initials\\'>${t.initials}</div>'" /></div>
            <div class="tinfo">
              <b>${t.name}</b>
              <div class="tmeta">${t.gender} ‚Ä¢ ${t.shift} shift ‚Ä¢ ${t.experience} yrs</div>
              <div class="tmeta">TIN: ${t.tin} ‚Ä¢ ID: ${t.idNo}</div>
            </div>
          `;
          section.appendChild(tEl);
        });

        secRow.appendChild(section);
        sEl.appendChild(secRow);
        grid.appendChild(sEl);
      });

      dEl.appendChild(grid);
      contentArea.appendChild(dEl);
    });
  });
}

// Statistics view (table)
function renderStatistics(){
  const totals = computeTotals();
  contentArea.innerHTML = '';

  // add small dashboard on top of stats page too
  const dash = renderDashboard();
  contentArea.appendChild(dash);

  const statsCard = document.createElement('div');
  statsCard.className = 'card';
  statsCard.style.marginTop = '1rem';
  statsCard.innerHTML = `<h3 style="margin-top:0;color:var(--gold)">üìä GAMBIA TEACHER SUMMARY REPORT</h3>
    <div class="small" style="margin-bottom:.6rem">Per-region breakdown by level and totals</div>`;

  // table
  const tbl = document.createElement('table');
  tbl.innerHTML = `
    <thead><tr><th>Region</th><th>Primary</th><th>Junior</th><th>Senior</th><th>Total</th></tr></thead>
    <tbody>
      ${totals.regions.map(r => `<tr>
        <td>${r.region}</td>
        <td>${r.byLevel.Primary||0}</td>
        <td>${r.byLevel.Junior||0}</td>
        <td>${r.byLevel.Senior||0}</td>
        <td>${r.total}</td>
      </tr>`).join('')}
      <tr style="font-weight:700">
        <td>TOTAL NATIONWIDE</td>
        <td>${totals.nationwide.byLevel.Primary||0}</td>
        <td>${totals.nationwide.byLevel.Junior||0}</td>
        <td>${totals.nationwide.byLevel.Senior||0}</td>
        <td>${totals.nationwide.total}</td>
      </tr>
    </tbody>
  `;
  statsCard.appendChild(tbl);
  contentArea.appendChild(statsCard);
}

// helper: populate district dropdown
function populateDistricts(regionObj){
  districtFilter.innerHTML = '<option value="">All Districts</option>';
  schoolFilter.innerHTML = '<option value="">All Schools</option>';
  regionObj.districts.forEach(d => {
    const opt = document.createElement('option');
    opt.value = d.district;
    opt.textContent = d.district;
    districtFilter.appendChild(opt);
  });
}

// helper to populate schools dropdown
function populateSchoolsFrom(regionName, districtName){
  schoolFilter.innerHTML = '<option value="">All Schools</option>';
  const region = fullData.find(r => r.region === regionName);
  if(!region) return;
  const district = region.districts.find(d => d.district === districtName);
  if(!district) return;
  district.schools.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s.name;
    opt.textContent = s.name;
    schoolFilter.appendChild(opt);
  });
}

// select first region by default
function selectRegion(idx){
  currentRegionIndex = idx;
  [...regionListEl.children].forEach((c,i) => c.classList.toggle('active', i===idx));
  currentView = 'regions';
  render();
  const regionObj = fullData[idx];
  populateDistricts(regionObj);
  districtFilter.value = '';
  schoolFilter.value = '';
}

// central render
function render(){
  if(currentView === 'stats'){
    renderStatistics();
  } else {
    // default region view: render the selected region (or the first)
    const regionObj = fullData[currentRegionIndex] || fullData[0];
    // ensure first region is highlighted
    [...regionListEl.children].forEach((c,i) => c.classList.toggle('active', i===currentRegionIndex));
    renderRegion(regionObj);
  }
}

// filter logic (listening still applies and will call filterAndRender)
function onFilterChangeOrSearch(){
  // if any filter is active or search has query, show filtered combined view
  const q = (searchInput.value || '').trim();
  const regionVal = regionFilter.value;
  const districtVal = districtFilter.value;
  const schoolVal = schoolFilter.value;
  if(q || regionVal || districtVal || schoolVal){
    currentView = 'regions';
    filterAndRender();
  } else {
    // no filters - show current region (with dashboard)
    render();
  }
}

// populate district dropdown when region changes
regionFilter.addEventListener('change', () => {
  const val = regionFilter.value;
  districtFilter.innerHTML = '<option value="">All Districts</option>';
  schoolFilter.innerHTML = '<option value="">All Schools</option>';
  if(!val){
    onFilterChangeOrSearch(); return;
  }
  const regionObj = fullData.find(r => r.region === val);
  if(regionObj){
    regionObj.districts.forEach(d => {
      const o = document.createElement('option');
      o.value = d.district;
      o.textContent = d.district;
      districtFilter.appendChild(o);
    });
  }
  onFilterChangeOrSearch();
});

// when district changes, populate schools
districtFilter.addEventListener('change', () => {
  const regionVal = regionFilter.value || fullData[currentRegionIndex].region;
  const districtVal = districtFilter.value;
  schoolFilter.innerHTML = '<option value="">All Schools</option>';
  if(regionVal && districtVal){
    const regionObj = fullData.find(r => r.region === regionVal);
    if(regionObj){
      const districtObj = regionObj.districts.find(d => d.district === districtVal);
      if(districtObj){
        districtObj.schools.forEach(s => {
          const o = document.createElement('option');
          o.value = s.name;
          o.textContent = s.name;
          schoolFilter.appendChild(o);
        });
      }
    }
  }
  onFilterChangeOrSearch();
});

schoolFilter.addEventListener('change', onFilterChangeOrSearch);
searchInput.addEventListener('input', () => {
  clearTimeout(window._searchTimer);
  window._searchTimer = setTimeout(onFilterChangeOrSearch, 180);
});

clearBtn.addEventListener('click', () => {
  searchInput.value = '';
  regionFilter.value = '';
  districtFilter.innerHTML = '<option value="">All Districts</option>';
  schoolFilter.innerHTML = '<option value="">All Schools</option>';
  // reset selection highlight
  [...regionListEl.children].forEach(c => c.classList.remove('active'));
  // show initial region with dashboard
  currentRegionIndex = 0;
  currentView = 'regions';
  render();
});

// view stats button
viewStatsBtn.addEventListener('click', () => {
  currentView = 'stats';
  render();
});

// sidebar buttons
sidebarRegionsBtn.addEventListener('click', () => {
  currentView = 'regions';
  render();
});
sidebarStatsBtn.addEventListener('click', () => {
  currentView = 'stats';
  render();
});

// button inside dashboard to open first region
document.addEventListener('click', (e) => {
  if(e.target && e.target.id === 'goToFirstRegion'){
    selectRegion(0);
  }
});

// initial load
selectRegion(0);
render();

</script>
</body>
</html>